#+TITLE: eshell history
# Tags #emacs

Code to save history whenever a command is run. Default setup only saves history when the eshell exits.
[[https://emacs.stackexchange.com/a/18569/2666][stackexchange]]

#+begin_src emacs-lisp
(setq eshell-save-history-on-exit nil)
(defun eshell-append-history ()
  "Call `eshell-write-history' with the `append' parameter set to `t'."
  (when eshell-history-ring
    (let ((newest-cmd-ring (make-ring 1)))
      (ring-insert newest-cmd-ring (car (ring-elements eshell-history-ring)))
      (let ((eshell-history-ring newest-cmd-ring))
        (eshell-write-history eshell-history-file-name t)))))
(add-hook eshell-pre-command-hook #'eshell-append-history)
#+end_src
